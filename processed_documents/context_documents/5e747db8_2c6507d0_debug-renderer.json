{
  "content": "Bullet Debug Renderer\n\nIn the previous \"hello world\" sample we have been introduced to a few Bullet physics objects, for example the rigid body (.BulletRigidBodyNode) or box and plane collision shapes (.BulletPlaneShape, .BulletBoxShape).\n\nThese objects are part of the Panda3D scene graph. But they are not visible. In order to be able to actually see a rigid body we had to reparent a visible geometry below the rigid body node. This is fine, since we (1) can control the way an object looks like, by choosing whatever visible geometry we want, and (2) we can create invisible objects too, by not reparenting any geometry below a rigid body.\n\nBut when developing a game it sometimes would be handy to actually see where the physical objects are. This is what the .BulletDebugNode is for. It's not meant for users playing the game, but as an aid in finding problems while developing the game.\n\nThe debug node is pretty easy to use. We just need to create such a node, place it in the scene graph, and tell the Bullet world that we have such a node. From now on Bullet will create a \"debug\" visualisation of the world's content within the debug node, whenever ~panda3d.bullet.BulletWorld.do_physics() is called. The following code snippet shows how to do this:\n\npython\n\nfrom panda3d.bullet import BulletDebugNode\n\ndebugNode = BulletDebugNode('Debug')\ndebugNode.showWireframe(True)\ndebugNode.showConstraints(True)\ndebugNode.showBoundingBoxes(False)\ndebugNode.showNormals(False)\ndebugNP = render.attachNewNode(debugNode)\ndebugNP.show()\n\nworld = BulletWorld()\nworld.setGravity(Vec3(0, 0, -9.81))\nworld.setDebugNode(debugNP.node())\n\ncpp\n\n#include \"panda3d/bulletDebugNode.h\"\n...\nPT(BulletDebugNode) bullet_dbg_node;\nbullet_dbg_node = new BulletDebugNode(\"Debug\");\nbullet_dbg_node->show_bounding_boxes(true);\nbullet_dbg_node->show_constraints(true);\nbullet_dbg_node->show_normals(true);\nbullet_dbg_node->show_wireframe(true);\n\nNodePath np_dbg_node = window->get_render().attach_new_node(get_physics_debug_node());\nnp_dbg_node.show();\n\nphysics_world->set_debug_node(get_physics_debug_node());\n...\n\nWe can control the amount of information rendered using the following methods:\n\nThere is one thing to pay attention to: By default the .BulletDebugNode is hidden right after creation. If we want to see the debug visualisation from the first frame on we have to unhide it, using ~.NodePath.show().\n\nSince debug rendering is not very fast we can turn debug rendering on and off, without having to remove the debug node from the scene graph. Turning debug rendering on and of is simply done by hiding or showing the debug node. The following code shows how to toggle debug node visibility on and off, using the F1 key:\n\npython\n\nfrom direct.showbase.DirectObject import DirectObject\n\no = DirectObject()\no.accept('f1', toggleDebug)\n\ndef toggleDebug():\n    if debugNP.isHidden():\n        debugNP.show()\n    else:\n        debugNP.hide()\n\ncpp\n\n...\nvoid toggle_physics_debug(const Event *e, void *data) {\n    static bool show_state = true;\n    show_state = !show_state;\n    bullet_dbg_node->show_bounding_boxes(show_state);\n    bullet_dbg_node->show_constraints(show_state);\n    bullet_dbg_node->show_normals(show_state);\n    bullet_dbg_node->show_wireframe(show_state);\n}\n...\nframework.define_key(\"f1\", \"Toggle Physics debug\", toggle_physics_debug, nullptr);\n....\n\nYou can notice that CXX code made Toggle action in different way than Python code, the reason is simple, CXX uses the BulletDebugNode instead of NodePath that parent first node, anyway you can apply the last one using global variables or static function calls, or use directly BulletDebugNode like the following program.\n\n// Bullet Debug Node Example.\n// The following example is done from Python sources, Panda Reference and Panda Manual,\n// for more information, visit Panda3D and/or Bullet physics web site.\n\n// Compiling and Linking documentation and notes are not\n// covered in this file, check manual for mor information.\n\n#include \"panda3d/pandaFramework.h\"\n#include \"panda3d/windowFramework.h\"\n#include \"panda3d/nodePath.h\"\n#include \"panda3d/clockObject.h\"\n\n#include \"panda3d/asyncTask.h\"\n#include \"panda3d/genericAsyncTask.h\"\n\n#include \"panda3d/bulletWorld.h\"\n#include \"panda3d/bulletDebugNode.h\"\n#include \"panda3d/bulletPlaneShape.h\"\n#include \"panda3d/bulletBoxShape.h\"\n\nBulletWorld *get_physics_world() {\n    // physics_world is supposed to be an global variable,\n    // but declaring global variables is not cool\n    // for good programmers lol, instead, should use static keyword.\n    static BulletWorld *physics_world = new BulletWorld();\n    return physics_world;\n}\n\nBulletDebugNode *get_physics_debug_node() {\n    // Global variable.\n    static BulletDebugNode *bullet_dbg_node = new BulletDebugNode(\"Debug\");\n    return bullet_dbg_node;\n}\n\nvoid toggle_physics_debug(const Event *e, void *data) {\n    static bool show_state = true;\n    show_state = !show_state;\n    get_physics_debug_node()->show_bounding_boxes(show_state);\n    get_physics_debug_node()->show_constraints(show_state);\n    get_physics_debug_node()->show_normals(show_state);\n    get_physics_debug_node()->show_wireframe(show_state);\n}\n\nAsyncTask::DoneStatus update_scene(GenericAsyncTask* task, void* data) {\n    // Get dt (from Python example) and apply to do_physics(float, int, int);\n    ClockObject *co = ClockObject::get_global_clock();\n    get_physics_world()->do_physics(co->get_dt(), 10, 1.0 / 180.0);\n\n    return AsyncTask::DS_cont;\n}\n\nint main(int argc, char *argv[]) {\n    // All variables.\n    PandaFramework framework;\n    WindowFramework *window;\n    PT(AsyncTaskManager) task_mgr;\n\n    // Init everything :D\n    framework.open_framework(argc, argv);\n    framework.set_window_title(\"Bullet Physics\");\n\n    window = framework.open_window();\n    window->enable_keyboard();\n    window->setup_trackball();\n\n    task_mgr = AsyncTaskManager::get_global_ptr();\n\n    // Make physics simulation.\n    // Static world stuff.\n    get_physics_world()->set_gravity(0, 0, -9.8);\n\n    PT(BulletPlaneShape) floor_shape = new BulletPlaneShape(LVecBase3(0, 0, 1), 1);\n    PT(BulletRigidBodyNode) floor_rigid_node = new BulletRigidBodyNode(\"Ground\");\n\n    floor_rigid_node->add_shape(floor_shape);\n\n    NodePath np_ground = window->get_render().attach_new_node(floor_rigid_node);\n    np_ground.set_pos(0, 0, -2);\n    get_physics_world()->attach(floor_rigid_node);\n\n    // Dynamic world stuff.\n    PT(BulletBoxShape) box_shape = new BulletBoxShape(LVecBase3(0.5, 0.5, 0.5));\n    PT(BulletRigidBodyNode) box_rigid_node = new BulletRigidBodyNode(\"Box\");\n\n    box_rigid_node->set_mass(1.0); // Gravity affects this rigid node.\n    box_rigid_node->add_shape(box_shape);\n\n    NodePath np_box = window->get_render().attach_new_node(box_rigid_node);\n    np_box.set_pos(0, 0, 2);\n    get_physics_world()->attach(box_rigid_node);\n\n    NodePath np_box_model = window->load_model(framework.get_models(), \"models/box\");\n    np_box_model.set_pos(-0.5, -0.5, -0.5);\n    np_box.flatten_light();\n    np_box_model.reparent_to(np_box);\n\n    // Debug stuff.\n    get_physics_debug_node()->show_bounding_boxes(true);\n    get_physics_debug_node()->show_constraints(true);\n    get_physics_debug_node()->show_normals(true);\n    get_physics_debug_node()->show_wireframe(true);\n\n    NodePath np_dbg_node = window->get_render().attach_new_node(get_physics_debug_node());\n    np_dbg_node.show();\n\n    get_physics_world()->set_debug_node(get_physics_debug_node());\n    framework.define_key(\"f1\", \"Toggle Physics debug\", toggle_physics_debug, nullptr);\n\n    // Setup tasks and keys.\n    PT(GenericAsyncTask) task;\n    task = new GenericAsyncTask(\"Scene update\", &update_scene, nullptr);\n    task_mgr->add(task);\n\n    framework.main_loop();\n    framework.close_framework();\n\n    return (0);\n}",
  "metadata": {
    "source": "corpus_panda3d/collected_docs/2c6507d0_debug-renderer.rst",
    "doc_type": "rst",
    "file_path": "processed_documents/context_documents/5e747db8_2c6507d0_debug-renderer.json",
    "doc_id": "doc_603"
  }
}