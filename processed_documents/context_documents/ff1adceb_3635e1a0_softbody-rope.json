{
  "content": "Bullet Softbody Rope\n\nSoft body ropes are best compared to chains of interconnected nodes. This page deals with setup, visualization and attaching things to soft body ropes.\n\nSetup\n\nThe following code will create a soft body rope with 8 segments (variable res), and thus 8 + 2 = 10 nodes. p1 is the initial position of the first node, and p2 is the initial position of the last node. fixeds will be explained later on this page.\n\npython\n\nfrom panda3d.bullet import BulletSoftBodyNode\n\ninfo = self.world.getWorldInfo()\ninfo.setAirDensity(1.2)\ninfo.setWaterDensity(0)\ninfo.setWaterOffset(0)\ninfo.setWaterNormal(Vec3(0, 0, 0))\n\nres = 8\np1 = Point3(0, 0, 4)\np2 = Point3(10, 0, 4)\nfixeds = 0\n\nbodyNode = BulletSoftBodyNode.makeRope(info, p1, p2, res, fixeds)\nbodyNode.setTotalMass(50.0)\nbodyNP = worldNP.attachNewNode(bodyNode)\nworld.attachSoftBody(bodyNode)\n\ncpp\n\nTODO\n\nVisualisation\n\nSo far we have a physical object, the soft body rope, but aside from the debug renderer this object is not shown in our scene. We need something to visualize the rope.\n\nThere are two ways of rendering the rope. First we can make use of a NURBS curve, or we can simple render the rope using geom lines. First we have a look at how to render the rope using geom lines.\n\npython\n\nfrom panda3d.core import GeomNode\n\ngeom = BulletHelper.makeGeomFromLinks(bodyNode)\n\nvisNode = GeomNode('')\nvisNode.addGeom(geom)\nvisNP = bodyNP.attachNewNode(visNode)\n\nbodyNode.linkGeom(geom)\n\ncpp\n\nTODO\n\nThe class BulletHelper has a convenience method which creates a ready-to-use Geom for us. We only need to wrap the Geom in a GeomNode, and insert it into the scene graph. Since we want the visualisation of the rope to be at the same place as the rope we insert the GeomNode as a child of the BulletSoftBodyNode.\n\nThere is just one thing missing. The GeomNode doesn't know that it is the visualization of a soft body rope. When advancing the simulation time the soft body rope will deform, but the visualization will always stay the way it has been created. To fix this we can tell the soft body node that this particular Geom is it's visualization. The soft body node will now update the Geom each frame. This is done in the last line, by linking the geom to the soft body node.\n\nThe result doesn't look very good. It's just a thin line. But instead of the above code we can use a NURBS curve for visualization.\n\npython\n\nfrom panda3d.core import RopeNode\nfrom panda3d.core import NurbsCurveEvaluator\n\ncurve = NurbsCurveEvaluator()\ncurve.reset(res + 2)\n\nbodyNode.linkCurve(curve)\n\nvisNode = RopeNode('')\nvisNode.setCurve(curve)\nvisNode.setRenderMode(RopeNode.RMTube)\nvisNode.setUvMode(RopeNode.UVParametric)\nvisNode.setNumSubdiv(4)\nvisNode.setNumSlices(8)\nvisNode.setThickness(0.4)\nvisNP = self.worldNP.attachNewNode(visNode)\nvisNP.setTexture(loader.loadTexture('some_texture.jpg'))\n\ncpp\n\nTODO\n\nFirst we create a nurbs curve (NurbsCurveEvaluator), and then we link this nurbs curve to the soft body rope node. The soft body node will update the nurbs curve every frame from now on.\n\nBut we are not done yet. We still need to create something that can be seen in the scene graph. A RopeNode can render a NurbsCurveEvaluator. For details on how to configure the RopeNode please refer to the Panda3D API documentation; both the RopeNode and the NurbsCurveEvaluator are not part of the panda3d.bullet, but core Panda3D classes.\n\nAttaching the rope\n\nNow we have created a rope, and we can render it. Next we want to attach the rope to something, that is \"glue\" it either to some other object, usually a rigid body, or to a specific position of the world.\n\nAt the beginning of this page we promised to deal with the fixeds parameter later on the page. This is the place. Using the fixeds parameter we can attach the rope to a position in the world (global coordinates!). Depending on the value of this parameter we can attach different nodes/vertices of the rope:\n\n0: No node/vertex is attached.\n\n1: Only the first node/vertex is attached.\n\n2: Only the last node/vertex is attached.\n\n3: Both the first and the last node/vertex are attached.\n\nOr we want to attach the soft body rope to a rigid body. In the following code snippet the last node/vertex of a soft body rope is attached to a rigid body.\n\npython\n\n# NodePath for some BulletSoftBody \"rope\"\nsoftNP = ...\n\n# NodePath for some BulletRigidBody\nrigidNP = ...\n\n# Index of the last node of the rope\nidx = softNP.node().getNumNodes() - 1\n\n# Attach the last node of the rope with the rigid body\nsoftNP.node().appendAnchor(idx, rigidNP.node())\n\ncpp\n\nTODO",
  "metadata": {
    "source": "corpus_panda3d/collected_docs/3635e1a0_softbody-rope.rst",
    "doc_type": "rst",
    "file_path": "processed_documents/context_documents/ff1adceb_3635e1a0_softbody-rope.json",
    "doc_id": "doc_470"
  }
}