{
  "content": "from direct.directbase.DirectStart import *\nfrom panda3d.core import *\nimport math\n\n# These constants define the RGB colors of the light and dark bands in\n# the woodgrain.\nlightGrain = (0.72, 0.72, 0.45)\ndarkGrain = (0.49, 0.33, 0.11)\n\n\ndef chooseGrain(p, xi, yi, radius):\n    \"\"\" Applies the appropriate color to pixel (xi, yi), based on\n    radius, the computed distance from the center of the trunk. \"\"\"\n\n    # Get the fractional part of radius.\n    t = radius - math.floor(radius)\n\n    # Now t ranges from 0 to 1.  Make it see-saw from 0 to 1 and back.\n    t = abs(t - 0.5) * 2\n\n    # Now interpolate colors.\n    p.setXel(xi, yi,\n             lightGrain[0] + t * (darkGrain[0] - lightGrain[0]),\n             lightGrain[1] + t * (darkGrain[1] - lightGrain[1]),\n             lightGrain[2] + t * (darkGrain[2] - lightGrain[2]))\n\n\ndef calcRadius(xn, yn, x, y, z, noiseAmp):\n    \"\"\" Calculates radius, the distance from the center of the trunk,\n    for the 3-d point (x, y, z).  The point is perturbed with noise to\n    make the woodgrain seem more organic. \"\"\"\n\n    xp = x + xn.noise(x, y, z) * noiseAmp\n    yp = y + yn.noise(x, y, z) * noiseAmp\n\n    return math.sqrt(xp * xp + yp * yp)\n\n\ndef makeWoodgrain(texSize, texZSize, noiseScale, noiseZScale,\n                  noiseAmp, ringScale):\n\n    \"\"\" Generate a 3-D texture of size texSize x texSize x texZSize\n    that suggests woodgrain, with the grain running along the Z (W)\n    direction.  Since there is not as much detail parallel to the\n    grain as across it, the texture does not need to be as large in\n    the Z dimension as in the other two dimensions.\n\n    The woodgrain shape is perturbed with Perlin noise to make it more\n    organic.  The parameters noiseScale and noiseZScale controls the\n    frequency of the noise; larger numbers make smoother rings.  The\n    parameter noiseAmp controls the effect of the noise; larger\n    numbers make more dramatic distortions.\n\n    ringScale controls the number of rings visible in the cross\n    section of the texture.  A larger number makes more, denser rings.\n    \"\"\"\n\n    # First, create the two PerlinNoise objects to perturb the rings\n    # in two dimensions.  This class is defined in Panda3D.\n    xn = PerlinNoise3(noiseScale, noiseScale, noiseZScale)\n    yn = PerlinNoise3(noiseScale, noiseScale, noiseZScale)\n\n    # Start by creating a empty 3-D texture.\n    tex = Texture('woodgrain')\n    tex.setup3dTexture()\n\n    for zi in range(texZSize):\n        z = float(zi) / float(texZSize - 1) - 0.5\n\n        # Walk through the Z slices of the texture one at a time.  For\n        # each slice, we create a PNMImage, very much as if we were\n        # reading the texture from disk.\n        print(zi)\n        p = PNMImage(texSize, texSize)\n\n        # But instead of reading the PNMImage, we fill it in with the\n        # ring pattern.\n        for yi in range(texSize):\n            y = float(yi) / float(texSize - 1) - 0.5\n            for xi in range(texSize):\n                x = float(xi) / float(texSize - 1) - 0.5\n\n                radius = calcRadius(xn, yn, x, y, z, noiseAmp)\n                chooseGrain(p, xi, yi, radius * ringScale)\n\n        # Now load the current slice into the texture.\n        tex.load(p, zi, 0)\n\n    return tex\n\n\n# Create a 3-D texture.\ntex = makeWoodgrain(texSize=256, texZSize=8, noiseScale=0.4, noiseZScale=0.8,\n                    noiseAmp=0.12, ringScale=40)\n\n# Write out the texture.  This will generate woodgrain_0.png,\n# woodgrain_1.png, and so on, in the current directory.\ntex.write(Filename('woodgrain-#.png'), 0, 0, True, False)\n",
  "metadata": {
    "source": "corpus_panda3d/collected_docs/675b1c1c_woodgrain-example.py",
    "doc_type": "python",
    "file_path": "processed_documents/context_documents/d207d691_675b1c1c_woodgrain-example.json",
    "doc_id": "doc_3"
  }
}